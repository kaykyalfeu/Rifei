{% extends "layouts/base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- Header -->
{% include "components/header.html" %}

<!-- Main Layout with Sidebar -->
<div class="pt-16 lg:pl-64 min-h-screen">
    {% include "components/sidebar.html" %}

    <!-- Main Content -->
    <main class="p-4 md:p-8">
        <!-- Page Header -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
            <div>
                <h1 class="text-3xl md:text-4xl font-black mb-2">Dashboard</h1>
                <p class="text-gray-500">Acompanhe suas rifas e estatisticas</p>
            </div>
            <a href="/criar" class="px-6 py-3 rounded-xl gradient-primary text-white font-semibold shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40 transition-all flex items-center gap-2 w-fit">
                <i data-lucide="plus" class="w-5 h-5"></i>
                Criar Nova Rifa
            </a>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="glass rounded-2xl p-6 border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-xl bg-emerald-500/10 flex items-center justify-center">
                        <i data-lucide="package" class="w-6 h-6 text-emerald-600"></i>
                    </div>
                    <span class="text-xs px-2 py-1 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 font-medium">
                        Total
                    </span>
                </div>
                <p class="text-3xl font-black">{{ stats.total_rifas or 0 }}</p>
                <p class="text-sm text-gray-500">Rifas criadas</p>
            </div>

            <div class="glass rounded-2xl p-6 border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center">
                        <i data-lucide="play-circle" class="w-6 h-6 text-blue-600"></i>
                    </div>
                    <span class="text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 font-medium">
                        Ativas
                    </span>
                </div>
                <p class="text-3xl font-black">{{ stats.active_rifas or 0 }}</p>
                <p class="text-sm text-gray-500">Rifas em andamento</p>
            </div>

            <div class="glass rounded-2xl p-6 border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-xl bg-violet-500/10 flex items-center justify-center">
                        <i data-lucide="ticket" class="w-6 h-6 text-violet-600"></i>
                    </div>
                    <span class="text-xs px-2 py-1 rounded-full bg-violet-100 text-violet-700 dark:bg-violet-900/30 dark:text-violet-400 font-medium">
                        Vendidos
                    </span>
                </div>
                <p class="text-3xl font-black">{{ stats.total_tickets_sold or 0 }}</p>
                <p class="text-sm text-gray-500">Numeros vendidos</p>
            </div>

            <div class="glass rounded-2xl p-6 border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-xl bg-yellow-500/10 flex items-center justify-center">
                        <i data-lucide="wallet" class="w-6 h-6 text-yellow-600"></i>
                    </div>
                    <span class="text-xs px-2 py-1 rounded-full bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400 font-medium">
                        Receita
                    </span>
                </div>
                <p class="text-3xl font-black text-emerald-600">R$ {{ "%.2f" | format(stats.total_revenue or 0) }}</p>
                <p class="text-sm text-gray-500">Faturamento total</p>
            </div>
        </div>

        <!-- Recent Activity & Quick Actions -->
        <div class="grid lg:grid-cols-3 gap-8 mb-8">
            <!-- My Rifas List -->
            <div class="lg:col-span-2 glass rounded-3xl border border-gray-200/50 dark:border-gray-700/50 overflow-hidden">
                <div class="p-6 border-b border-gray-200/50 dark:border-gray-700/50 flex items-center justify-between">
                    <h2 class="font-bold text-lg">Minhas Rifas</h2>
                    <a href="/perfil" class="text-emerald-600 text-sm font-medium hover:underline">Ver todas</a>
                </div>

                <div class="divide-y divide-gray-200/50 dark:divide-gray-700/50">
                    {% if my_rifas %}
                    {% for rifa in my_rifas[:5] %}
                    <a href="/rifa/{{ rifa.slug }}" class="flex items-center gap-4 p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                        <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-emerald-400/20 to-violet-400/20 flex items-center justify-center text-2xl flex-shrink-0">
                            {% if rifa.image_url %}
                            <img src="{{ rifa.image_url }}" class="w-full h-full object-cover rounded-xl">
                            {% else %}
                            üéÅ
                            {% endif %}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-bold truncate">{{ rifa.title }}</h3>
                            <div class="flex items-center gap-4 text-sm text-gray-500">
                                <span>{{ rifa.sold_count }}/{{ rifa.total_numbers }}</span>
                                <span class="h-4 w-24 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                    <span class="block h-full gradient-primary" style="width: {{ rifa.progress_percent }}%"></span>
                                </span>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-emerald-600">R$ {{ "%.2f" | format(rifa.price * rifa.sold_count) }}</p>
                            <span class="px-2 py-0.5 rounded-full text-xs font-medium
                                {% if rifa.status.value == 'active' %}bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400
                                {% elif rifa.status.value == 'completed' %}bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400
                                {% elif rifa.status.value == 'draft' %}bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400
                                {% else %}bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400{% endif %}">
                                {{ rifa.status.value | capitalize }}
                            </span>
                        </div>
                    </a>
                    {% endfor %}
                    {% else %}
                    <div class="p-8 text-center">
                        <i data-lucide="package-x" class="w-12 h-12 mx-auto text-gray-300 mb-3"></i>
                        <p class="text-gray-500 mb-4">Voce ainda nao criou nenhuma rifa</p>
                        <a href="/criar" class="text-emerald-600 font-medium hover:underline">Criar primeira rifa</a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="space-y-4">
                <!-- Quick Actions Card -->
                <div class="glass rounded-2xl p-6 border border-gray-200/50 dark:border-gray-700/50">
                    <h3 class="font-bold mb-4">Acoes Rapidas</h3>
                    <div class="space-y-2">
                        <a href="/criar" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                            <div class="w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center">
                                <i data-lucide="plus" class="w-5 h-5 text-emerald-600"></i>
                            </div>
                            <span class="font-medium">Nova Rifa</span>
                        </a>
                        <a href="/marketplace" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                            <div class="w-10 h-10 rounded-xl bg-violet-500/10 flex items-center justify-center">
                                <i data-lucide="compass" class="w-5 h-5 text-violet-600"></i>
                            </div>
                            <span class="font-medium">Explorar</span>
                        </a>
                        <a href="/perfil" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                            <div class="w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center">
                                <i data-lucide="user" class="w-5 h-5 text-blue-600"></i>
                            </div>
                            <span class="font-medium">Meu Perfil</span>
                        </a>
                        <a href="/configuracoes" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                            <div class="w-10 h-10 rounded-xl bg-gray-500/10 flex items-center justify-center">
                                <i data-lucide="settings" class="w-5 h-5 text-gray-600"></i>
                            </div>
                            <span class="font-medium">Configuracoes</span>
                        </a>
                    </div>
                </div>

                <!-- Tips Card -->
                <div class="glass rounded-2xl p-6 border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-start gap-3">
                        <div class="w-10 h-10 rounded-xl bg-yellow-500/10 flex items-center justify-center flex-shrink-0">
                            <i data-lucide="lightbulb" class="w-5 h-5 text-yellow-600"></i>
                        </div>
                        <div>
                            <h4 class="font-bold mb-1">Dica do dia</h4>
                            <p class="text-sm text-gray-500">Rifas com imagens atraentes vendem ate 3x mais. Capriche nas fotos!</p>
                        </div>
                    </div>
                </div>

                <!-- Premium Promo -->
                <div class="rounded-2xl p-6 bg-gradient-to-br from-yellow-400 to-orange-500 text-white">
                    <div class="flex items-center gap-2 mb-2">
                        <i data-lucide="zap" class="w-5 h-5"></i>
                        <span class="font-bold">Rifei Premium</span>
                    </div>
                    <p class="text-sm text-white/80 mb-4">Remova taxas e desbloqueie recursos exclusivos para suas rifas.</p>
                    <a href="/premium" class="block w-full py-2 rounded-xl bg-white text-orange-500 font-bold text-center hover:bg-gray-100 transition-colors">
                        Conhecer Premium
                    </a>
                </div>
            </div>
        </div>

        <!-- Recent Participations -->
        <div class="glass rounded-3xl border border-gray-200/50 dark:border-gray-700/50 overflow-hidden">
            <div class="p-6 border-b border-gray-200/50 dark:border-gray-700/50 flex items-center justify-between">
                <h2 class="font-bold text-lg">Minhas Participacoes</h2>
                <a href="/perfil" class="text-emerald-600 text-sm font-medium hover:underline">Ver todas</a>
            </div>

            {% if participations %}
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 p-6">
                {% for participation in participations[:6] %}
                <a href="/rifa/{{ participation.rifa.slug }}" class="flex items-center gap-3 p-4 rounded-xl bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-400/20 to-violet-400/20 flex items-center justify-center text-xl flex-shrink-0">
                        üé´
                    </div>
                    <div class="flex-1 min-w-0">
                        <h4 class="font-bold text-sm truncate">{{ participation.rifa.title }}</h4>
                        <p class="text-xs text-gray-500">Numero{% if participation.numbers | length > 1 %}s{% endif %}: {{ participation.numbers | join(', ') }}</p>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="p-8 text-center">
                <i data-lucide="ticket" class="w-12 h-12 mx-auto text-gray-300 mb-3"></i>
                <p class="text-gray-500 mb-4">Voce ainda nao participou de nenhuma rifa</p>
                <a href="/marketplace" class="text-emerald-600 font-medium hover:underline">Explorar rifas</a>
            </div>
            {% endif %}
        </div>
    </main>
</div>
{% endblock %}
